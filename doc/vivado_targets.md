# Vivado and XSIM TARGETS

Overview
----
```mermaid
flowchart TD
    A[RTL Files] --> B[[Vivado Import]]

    a[simulation_files] --> D
    B --> | make sim | D[[Analysis]]
    D --> E[[Elaboration]]
    E --> F[[RTL Simulation]]

    B --> | make vivado-gui | C[[Open gui to edit\n block design]]

    B --> | make vivado-all | G[[Synthesis]]
    b[pre/post-synthesis constraints] --> G
    c[pre/post-opt_design constraints] --> H
    G --> | make vivado-all | H[[opt_design]]
    d[pre/post place_design constraints] --> I
    H --> | make vivado-all | I[[place_design]]
    e(pre/post route_design constraints) --> J
    I --> | make vivado-all | J[[route_design]]
    J --> | make-vivado-all | K[[write_bitstream]]

    G --> | make vivado-gui-synth | M[[Open post-synthesis\n DCP in vivado gui]]
    H --> | make vivado-gui-opt   | N[[Open post-opt_design\n DCP in vivado gui]]
    I --> | make vivado-gui-place | O[[Open post-place_design\n DCP in vivado gui]]
    J --> | make vivado-gui-route | P[[Open post-route_design\n DCP in vivado gui]]
```

Generating bitstream
----
```bash
make vivado-all
```
This will generate bitstream (.bit) and hardware platform (.xsa) files.

Execute Vivado in GUI mode
----
```bash
make vivado-gui
```

Open synthetized design in GUI
----
```bash
make vivado-gui-synth
```

Open optimized design in GUI (first step of implementation)
----
```bash
make vivado-gui-opt
```

Open placed design in GUI (second step of implementation)
----
```bash
make vivado-gui-placement
```

Open routed design in GUI (final step of implementation)
----
```bash
make vivado-gui-route
```

Cleaning Vivado output products
----
```bash
make vivado-clean
```

Adding debug probes
----
First open synthetized design
```bash
make vivado-gui-synth
```
Then select the signal you want to debug. Do right click on it and select `Mark Debug`.

Repeat this operations for each signal to debug.

In the menubar, click on `Tools` then `Set Up Debug` and follow the instructions in the dialog window.

In tcl console, get all tcl commands (in blue) to generate the ILA cores. Then copy them in an xdc file in project folder and add it to the `PROBE_CONSTRAINTS` is the project mk file.
```Makefile
  PROBE_CONSTRAINTS += <path to xdc file>
```

Then you can close the vivado window.

Then regenerate bitstream with the argument `USE_PROBES=YES` and program the board (using baremetal or buildroot flow).

Then open vivado gui.
```bash
vivado &
```
Then click on `Open Hardware Manager` then `Open Target` and select `Auto Connect`. The waveforms of ILA are opening.

Click on `Specify the probes and refresh the device` and select the file `<build_dir>/vivado/probes.ltx`.

Behavioral simulation using XSIM (Xilinx Simulator):
----
```bash
make sim SIM_TOP=<simulation_top_entity> SIM_MODE=<gui|cli>
```
Launch behavioral simulation.

Default value for `SIM_TOP`: defined in project (top level testbench)

Default value for `SIM_MODE`: `gui`

Cleaning simulation files
----
```bash
make sim-clean
```
This will delete all files generated by XSIM

